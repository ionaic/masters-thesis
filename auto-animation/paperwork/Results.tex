
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%                                                                 %
%                           RESULTS                               %
%                                                                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
 
% \specialhead{INTRODUCTION}
\chapter{RESULTS}
\label{chapter:results}
The windup PD controller was given constants of $k_p = 0.25$ and $k_d = 0.25$.  These were chosen empirically to offset irregularities do to time step and slow convergence in the inverse kinematic solver.  With higher values, the translation of the pelvis results in the character's feet embedding in the ground plane due to too great a movement in a single frame.  The feet then fail to adjust as the inverse kinematic solver cannot converge quickly enough.  These values were found to generally produce smooth windup phases without compromising on speed of the animation too much.

Muscle spring constants were tested in various configurations, with several trials run for each set of constants for varying distances, directions, and situations.  Animations were created for forward jumps between 1m and 2m for the normal human values and at 1m, 10m, and 100m for the super human.  A jump onto a box was also simulated, with 0.5m and 0.75m boxes for the normal human and 1m and 100m boxes for the super human.  The normal human muscle constants were additionally used for sideways jumping animations, as well as a more complex scene in which the character is made to jump from on top of a box, over an obstacle before finally landing on the ground.

%biomechanics of sport and exercise
Jump animations appear plausible, and the spring values result in forces similar to a human muscle.  Human muscles have about $30\frac{N}{cm^2}$ force per cross-sectional area.  The character's leg thickness is about $0.20m$ forward to back narrowing towards the knee, with a left-right thickness of around $0.15m$. If we assume that skin is about $0.002m$ thick (2mm) and about $15\%$ of the remainder is subcutaneous fat, we are left with a $0.1683m$ by $0.1258m$ cross section.  This gives an axial cross sectional area of approximately $0.021m^2$.  We use a bone width of $0.05m$, giving a cross sectional bone area of $0.0025m^2$ which leaves an area of $0.019m^2$ of non-bone muscle.  If half of this is extensor muscle, then we have an approximate cross sectional area of $0.0095m^2$ or $95cm^2$.  This means that the estimated maximum isometric force for the muscle is $F = \left(30 \frac{N}{cm^2}\right) \left(95cm^2\right) = 2850N$.  With a $k$ of 20000, our muscle produces \[
	F = -k \left(\dfrac{r \sin (\pi - \theta)}{\sin \frac{\theta}{2}} \right)
\]
which for a joint bend of $\frac{\pi}{2}$ radians is 
%  The character in our simulation has a femur length of 0.4m and a shin length of 0.33m.  Our muscle crossing the knee has anchor points set between the knee and the ankle, and the knee and hip.  These anchors are set at $0.2 * 0.33m = 0.066m$ and $0.9 * 0.4m = 0.36m$ respectively, where $0.2$ and $0.9$ are values in $[0,1]$ which indicate how far along the bone the anchor is set as described in \ref{subsection:skel_joints}.  This gives a total length for this muscle as $0.426m$ or $42.6cm$. 

\begin{table}[ht]
	\centering
	\scriptsize
	\begin{tabular}{| c | c | c | c | c | c | c |}
		\hline
		& Left Hip & Left Knee & Left Ankle & Right Hip & Right Knee & Right Ankle \\ \hline
		Global, Normal & 20000 & 20000 & 20000 & 20000 & 20000 & 20000 \\ \hline
		Varying, Normal & 20000 & 24000 & 16000 & 20000 & 24000 & 16000 \\ \hline
		Uneven Global, Normal & 16000 & 16000 & 16000 & 24000 & 24000 & 24000 \\ \hline
		Uneven Varying, Normal & 24000 & 28000 & 20000 & 16000 & 20000 & 12000 \\ \hline
		Global, Super & $1 \times 10^9$ & $1 \times 10^9$ & $1 \times 10^9$ & $1 \times 10^9$ & $1 \times 10^9$ & $1 \times 10^9$ \\ \hline
	\end{tabular}
	\caption[Table of spring constants for each trial]{This table shows muscle spring constants ($k$) values used for several trial runs.  Each column represents a muscle, described by the center joint which indicates the joint the muscle crosses and affects.  Each row represents a different trial, with a set of $k$ values.  Global runs used a uniform $k$ for one or both sides of the body, while varying runs used different spring constants for each muscle.  Uneven runs were meant to mimic a character with an injury or other source of imbalance where one leg was significantly stronger than the other.}
	\label{tab:run_k_vals}
\end{table}


%TODO should the frame data dump be moved to the appendix?
\section{Output Animations}
\label{section:image_results}

\newcommand{\floatedfig}[1]{\begin{subfigure}[h]{0.2\textwidth}\vspace{1mm}\includegraphics[width=\textwidth]{#1}\vspace{1mm}\end{subfigure}\hspace{0.025\textwidth}}
%\newcommand{\floatedfig}[1]{\subfloat{\includegraphics[width=0.2\textwidth]{#1}}}
\newcommand{\framesubfig}[1]{\begin{subfigure}[h]{0.24\textwidth}\includegraphics[width=\textwidth]{#1}\end{subfigure}}

\begin{figure}[ht]
	\centering
	\begin{subfigure}[h]{\textwidth}
		\includegraphics[width=\textwidth]{images/trials/K200000global/ComplexScene/BestPlacement/side-camera-composite.png}
	\end{subfigure}\vspace{1mm}
	%\raggedleft
	\framesubfig{images/trials/K200000global/ComplexScene/BestPlacement/side/frame0001.png}
	\framesubfig{images/trials/K200000global/ComplexScene/BestPlacement/side/frame0005.png}
	\framesubfig{images/trials/K200000global/ComplexScene/BestPlacement/side/frame0010.png}
	\framesubfig{images/trials/K200000global/ComplexScene/BestPlacement/side/frame0015.png}
	\framesubfig{images/trials/K200000global/ComplexScene/BestPlacement/side/frame0020.png}
	\framesubfig{images/trials/K200000global/ComplexScene/BestPlacement/side/frame0030.png}
	\framesubfig{images/trials/K200000global/ComplexScene/BestPlacement/side/frame0035.png}
	\framesubfig{images/trials/K200000global/ComplexScene/BestPlacement/side/frame0040.png}
	\framesubfig{images/trials/K200000global/ComplexScene/BestPlacement/side/frame0045.png}
	\framesubfig{images/trials/K200000global/ComplexScene/BestPlacement/side/frame0050.png}	
	\framesubfig{images/trials/K200000global/ComplexScene/BestPlacement/side/frame0054.png}
	\caption[Animation of a jump over an obstacle]{Pictured is an animation of a complex scene, in which the character must jump from on top of a box, over another box and land on the ground.  The first image in the figure shows the frames composited into one image to visualize the full motion, while the remaining images show the individual frames.}
\end{figure}

\input{frame_data_tables.tex}

\section{Limitations}
\label{section:limitations}
Our system has a number of limitations and failure cases.  First is that there are many constants to be specified, which is work intensive but gives freedom to make wide changes to the animation by tuning parameters

Limited secondary motion.


\section{Summary}
\label{section:results_summary}

